<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>è‡ªåŠ¨åŒ–å…¬ä¼—å·å†™ç¨¿ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        .control-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .control-group input,
        .control-group select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .control-group input:focus,
        .control-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .provider-select {
            display: flex;
            gap: 15px;
        }

        .provider-option {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .provider-option:hover {
            border-color: #667eea;
            background: #f5f5ff;
        }

        .provider-option.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .provider-option h3 {
            font-size: 1em;
            margin-bottom: 5px;
        }

        .provider-option p {
            font-size: 0.8em;
            opacity: 0.8;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            flex: 1;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .progress-section {
            margin-top: 30px;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .current-step {
            margin-top: 15px;
            text-align: center;
            color: #666;
            font-size: 1.1em;
        }

        .logs-section {
            margin-top: 30px;
        }

        .logs-section h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .logs-container {
            background: #1e1e1e;
            border-radius: 10px;
            padding: 20px;
            height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid #333;
        }

        .log-time {
            color: #888;
            margin-right: 10px;
        }

        .log-info {
            color: #4fc3f7;
        }

        .log-success {
            color: #66bb6a;
        }

        .log-warning {
            color: #ffa726;
        }

        .log-error {
            color: #ef5350;
        }

        .result-section {
            margin-top: 30px;
            display: none;
        }

        .result-section.show {
            display: block;
        }

        .result-card {
            background: #f5f5ff;
            border-left: 4px solid #667eea;
            padding: 20px;
            border-radius: 8px;
        }

        .result-card h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .result-item {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .result-label {
            font-weight: 600;
            margin-right: 10px;
            min-width: 100px;
        }

        .result-value {
            color: #666;
        }

        .score-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
        }

        .score-good {
            background: #66bb6a;
            color: white;
        }

        .score-warning {
            background: #ffa726;
            color: white;
        }

        .score-bad {
            background: #ef5350;
            color: white;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .running .current-step {
            animation: pulse 1.5s infinite;
        }

        /* å†å²æ–‡ä»¶åˆ—è¡¨æ ·å¼ */
        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            transition: background 0.3s;
            cursor: pointer;
        }

        .history-item:hover {
            background: #f5f5ff;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-info {
            flex: 1;
        }

        .history-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            font-size: 15px;
        }

        .history-meta {
            font-size: 12px;
            color: #999;
        }

        .history-actions {
            display: flex;
            gap: 10px;
        }

        .history-btn {
            padding: 6px 12px;
            border: 1px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }

        .history-btn:hover {
            background: #667eea;
            color: white;
        }

        .empty-history {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        /* æä¾›å•†æ ‡ç­¾æ ·å¼ */
        .provider-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }

        .provider-badge.gemini-api {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .provider-badge.gemini-web {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .provider-badge.zhipu {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .provider-badge.gemini-deepseek {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        /* åˆ†é¡µæ§ä»¶æ ·å¼ */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }

        .pagination button {
            padding: 8px 16px;
            border: 1px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }

        .pagination button:hover:not(:disabled) {
            background: #667eea;
            color: white;
        }

        .pagination button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .pagination .page-info {
            font-size: 13px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ è‡ªåŠ¨åŒ–å…¬ä¼—å·å†™ç¨¿ç³»ç»Ÿ</h1>
            <p>é€‰æ‹© AI æä¾›å•†ï¼Œä¸€é”®ç”Ÿæˆé«˜è´¨é‡æ–‡ç« </p>
        </div>

        <div class="card">
            <div class="provider-select" id="providerSelect">
                <div class="provider-option active" data-provider="gemini">
                    <h3>ğŸ¤– Gemini 3 Pro</h3>
                    <p>å®˜æ–¹ APIï¼Œæ·±åº¦æ€è€ƒ</p>
                </div>
                <div class="provider-option" data-provider="gemini-web">
                    <h3>ğŸŒ Gemini Web</h3>
                    <p>å®¢æˆ·ç«¯ç‰ˆï¼Œæ— é…é¢é™åˆ¶</p>
                </div>
                <div class="provider-option" data-provider="zhipu">
                    <h3>ğŸ§  æ™ºè°± GLM</h3>
                    <p>ä¸­æ–‡ä¸“å®¶ï¼Œå¿«é€Ÿç¨³å®š</p>
                </div>
                <div class="provider-option" data-provider="gemini-deepseek">
                    <h3>ğŸš€ Gemini Web + DeepSeek</h3>
                    <p>Gemini Webå¤§çº² + DeepSeekå†™ä½œ</p>
                </div>
            </div>

            <div style="text-align: center; margin-bottom: 15px;">
                <button class="btn btn-secondary" onclick="openPromptConfig()" style="padding: 10px 20px;">
                    âš™ï¸ æµç¨‹é…ç½®
                </button>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label for="domain">å†…å®¹é¢†åŸŸ</label>
                    <input type="text" id="domain" value="æƒ…æ„Ÿ,å¿ƒç†,äººé™…å…³ç³»" placeholder="ä¾‹å¦‚ï¼šæƒ…æ„Ÿ,å¿ƒç†,ç§‘æŠ€">
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" id="startBtn" onclick="startTask()">
                    ğŸ¬ å¼€å§‹ç”Ÿæˆ
                </button>
                <button class="btn btn-secondary" id="stopBtn" onclick="stopTask()" disabled>
                    â¹ï¸ åœæ­¢
                </button>
            </div>

            <div class="progress-section" id="progressSection" style="display: none;">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%">0%</div>
                </div>
                <div class="current-step" id="currentStep">å‡†å¤‡ä¸­...</div>
            </div>

            <div class="logs-section" id="logsSection" style="display: none;">
                <h3>ğŸ“‹ å®æ—¶æ—¥å¿—</h3>
                <div class="logs-container" id="logsContainer"></div>
            </div>

            <!-- å†å²æ–‡ä»¶åŒºåŸŸ -->
            <div class="card" id="historySection" style="margin-top: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="color: #333; margin: 0;">ğŸ“š å†å²æ–‡ç« </h3>
                    <button class="btn btn-secondary" onclick="loadHistory(1)" style="width: auto; padding: 10px 20px; font-size: 14px;">
                        ğŸ”„ åˆ·æ–°åˆ—è¡¨
                    </button>
                </div>
                <div id="historyList" style="max-height: 300px; overflow-y: auto;">
                    <p style="text-align: center; color: #999; padding: 20px;">åŠ è½½ä¸­...</p>
                </div>
                <div id="paginationContainer" class="pagination" style="display: none;">
                    <button id="prevPageBtn" onclick="changePage(-1)">â† ä¸Šä¸€é¡µ</button>
                    <span class="page-info">
                        ç¬¬ <span id="currentPage">1</span> é¡µ / å…± <span id="totalPages">1</span> é¡µ
                        (æ€»è®¡ <span id="totalItems">0</span> ç¯‡)
                    </span>
                    <button id="nextPageBtn" onclick="changePage(1)">ä¸‹ä¸€é¡µ â†’</button>
                </div>
            </div>

            <div class="result-section" id="resultSection">
                <div class="result-card">
                    <h3>âœ… ç”Ÿæˆå®Œæˆ</h3>
                    <div class="result-item">
                        <span class="result-label">æ ‡é¢˜ï¼š</span>
                        <span class="result-value" id="resultTitle">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">AI è¯„åˆ†ï¼š</span>
                        <span class="score-badge" id="resultScore">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">æä¾›å•†ï¼š</span>
                        <span class="result-value" id="resultProvider">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">æ–‡ä»¶ï¼š</span>
                        <span class="result-value" id="resultFile">-</span>
                    </div>

                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary" onclick="previewArticle()" style="width: 100%; margin-bottom: 10px;">
                            ğŸ‘ï¸ é¢„è§ˆæ–‡ç« 
                        </button>
                        <button class="btn btn-primary" onclick="uploadToWechat()" style="width: 100%; margin-bottom: 10px; background: linear-gradient(135deg, #07c160 0%, #06ae56 100%);">
                            ğŸ“¤ ä¸Šä¼ åˆ°å…¬ä¼—å·è‰ç¨¿ç®± (API)
                        </button>
                        <button class="btn btn-primary" onclick="uploadToWechatBrowser()" style="width: 100%; margin-bottom: 10px; background: linear-gradient(135deg, #1890ff 0%, #096dd9 100%);">
                            ğŸŒ ç½‘é¡µç‰ˆå‘å¸ƒ (ä¸ªäººå…¬ä¼—å·)
                        </button>
                        <button class="btn btn-secondary" onclick="downloadArticle()" style="width: 100%;">
                            ğŸ’¾ ä¸‹è½½æ–‡ç« 
                        </button>
                    </div>
                </div>
            </div>

            <!-- æ–‡ç« é¢„è§ˆæ¨¡æ€æ¡† -->
            <div id="previewModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; padding: 20px; overflow-y: auto;">
                <div style="max-width: 800px; margin: 0 auto; background: white; border-radius: 15px; padding: 40px; margin-top: 50px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 style="margin: 0;">æ–‡ç« é¢„è§ˆ</h2>
                        <button onclick="closePreview()" style="background: none; border: none; font-size: 24px; cursor: pointer;">âœ•</button>
                    </div>
                    <div id="previewContent" style="line-height: 1.8; color: #333;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedProvider = 'gemini';
        let statusCheckInterval = null;

        // é€‰æ‹©æä¾›å•†
        document.querySelectorAll('.provider-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.provider-option').forEach(o => o.classList.remove('active'));
                this.classList.add('active');
                selectedProvider = this.dataset.provider;
            });
        });

        // å¼€å§‹ä»»åŠ¡
        async function startTask() {
            const domain = document.getElementById('domain').value;

            // æ›´æ–° UI
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            document.getElementById('progressSection').style.display = 'block';
            document.getElementById('logsSection').style.display = 'block';
            document.getElementById('resultSection').classList.remove('show');
            document.body.classList.add('running');

            // æ¸…ç©ºæ—¥å¿—
            document.getElementById('logsContainer').innerHTML = '';

            // å‘é€è¯·æ±‚
            try {
                const response = await fetch('/api/start', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        provider: selectedProvider,
                        domain: domain
                    })
                });

                const data = await response.json();

                if (data.success) {
                    // å¼€å§‹è½®è¯¢çŠ¶æ€
                    startStatusCheck();
                } else {
                    alert('å¯åŠ¨å¤±è´¥ï¼š' + data.error);
                    resetUI();
                }
            } catch (error) {
                alert('å¯åŠ¨å¤±è´¥ï¼š' + error.message);
                resetUI();
            }
        }

        // åœæ­¢ä»»åŠ¡
        async function stopTask() {
            try {
                await fetch('/api/stop', {
                    method: 'POST'
                });
                addLog('warning', 'ä»»åŠ¡å·²åœæ­¢');
                resetUI();
            } catch (error) {
                console.error('åœæ­¢å¤±è´¥:', error);
            }
        }

        // å¼€å§‹æ£€æŸ¥çŠ¶æ€
        function startStatusCheck() {
            if (statusCheckInterval) {
                clearInterval(statusCheckInterval);
            }

            statusCheckInterval = setInterval(checkStatus, 500);
        }

        // æ£€æŸ¥çŠ¶æ€
        async function checkStatus() {
            try {
                const response = await fetch('/api/status');
                const status = await response.json();

                // æ›´æ–°è¿›åº¦
                updateProgress(status.progress, status.current_step);

                // æ›´æ–°æ—¥å¿—
                if (status.logs && status.logs.length > 0) {
                    const container = document.getElementById('logsContainer');
                    const currentLogs = container.querySelectorAll('.log-entry').length;

                    // æ·»åŠ æ–°æ—¥å¿—
                    status.logs.slice(currentLogs).forEach(log => {
                        addLog(log.level, log.message, log.time);
                    });
                }

                // æ£€æŸ¥æ˜¯å¦å®Œæˆ
                if (!status.running && status.progress === 100) {
                    clearInterval(statusCheckInterval);
                    showResult(status.result);
                    resetUI();
                } else if (!status.running && status.error) {
                    clearInterval(statusCheckInterval);
                    addLog('error', 'é”™è¯¯ï¼š' + status.error);
                    resetUI();
                }
            } catch (error) {
                console.error('çŠ¶æ€æ£€æŸ¥å¤±è´¥:', error);
            }
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress(progress, step) {
            const fill = document.getElementById('progressFill');
            const stepText = document.getElementById('current_step');

            fill.style.width = progress + '%';
            fill.textContent = progress + '%';
            document.getElementById('currentStep').textContent = step;
        }

        // æ·»åŠ æ—¥å¿—
        function addLog(level, message, time = null) {
            if (!time) {
                const now = new Date();
                time = now.getHours().toString().padStart(2, '0') + ':' +
                       now.getMinutes().toString().padStart(2, '0') + ':' +
                       now.getSeconds().toString().padStart(2, '0');
            }

            const container = document.getElementById('logsContainer');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `
                <span class="log-time">[${time}]</span>
                <span class="log-${level}">${message}</span>
            `;
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(result) {
            if (!result) return;

            document.getElementById('resultTitle').textContent = result.title;
            document.getElementById('resultProvider').textContent = result.provider;
            document.getElementById('resultFile').textContent = result.filename;

            const scoreBadge = document.getElementById('resultScore');
            scoreBadge.textContent = result.ai_score + '%';
            scoreBadge.className = 'score-badge';
            if (result.ai_score < 30) {
                scoreBadge.classList.add('score-good');
            } else if (result.ai_score < 60) {
                scoreBadge.classList.add('score-warning');
            } else {
                scoreBadge.classList.add('score-bad');
            }

            document.getElementById('resultSection').classList.add('show');

            // ä¿å­˜å®Œæ•´ç»“æœåˆ°å…¨å±€å˜é‡
            window.currentResult = result;
        }

        // é¢„è§ˆæ–‡ç« 
        function previewArticle() {
            if (!window.currentResult) {
                alert('æ²¡æœ‰å¯é¢„è§ˆçš„æ–‡ç« ');
                return;
            }

            const content = window.currentResult.content;
            const title = window.currentResult.title;

            // å°† Markdown è½¬æ¢ä¸º HTMLï¼ˆç®€å•å¤„ç†ï¼‰
            let html = content
                .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                .replace(/\*\*(.*?)\*\*/gim, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/gim, '<em>$1</em>')
                .replace(/\n\n/gim, '</p><p>')
                .replace(/\n/gim, '<br>');

            document.getElementById('previewContent').innerHTML = '<h1>' + title + '</h1><br>' + html;
            document.getElementById('previewModal').style.display = 'block';
        }

        // å…³é—­é¢„è§ˆ
        function closePreview() {
            document.getElementById('previewModal').style.display = 'none';
        }

        // ä¸‹è½½æ–‡ç« 
        function downloadArticle() {
            if (!window.currentResult) {
                alert('æ²¡æœ‰å¯ä¸‹è½½çš„æ–‡ç« ');
                return;
            }

            const content = window.currentResult.content;
            const title = window.currentResult.title;
            const filename = window.currentResult.filename;

            // åˆ›å»º Blob å¹¶ä¸‹è½½
            const blob = new Blob([content], { type: 'text/markdown;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // ä¸Šä¼ åˆ°å¾®ä¿¡å…¬ä¼—å·
        async function uploadToWechat() {
            if (!window.currentResult) {
                alert('æ²¡æœ‰å¯ä¸Šä¼ çš„æ–‡ç« ');
                return;
            }

            if (!confirm('ç¡®å®šè¦ä¸Šä¼ åˆ°å¾®ä¿¡å…¬ä¼—å·è‰ç¨¿ç®±å—ï¼Ÿ\n\néœ€è¦ç¡®ä¿ .env æ–‡ä»¶ä¸­é…ç½®äº† WECHAT_APP_ID å’Œ WECHAT_APP_SECRET')) {
                return;
            }

            const title = window.currentResult.title;
            const content = window.currentResult.content;

            try {
                addLog('info', 'æ­£åœ¨ä¸Šä¼ åˆ°å¾®ä¿¡å…¬ä¼—å·...');

                const response = await fetch('/api/upload-wechat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title: title,
                        content: content
                    })
                });

                const data = await response.json();

                if (data.success) {
                    addLog('success', 'ä¸Šä¼ æˆåŠŸï¼è¯·ç™»å½•å…¬ä¼—å·åå°æŸ¥çœ‹è‰ç¨¿ç®±');
                    alert('âœ… ä¸Šä¼ æˆåŠŸï¼\n\nè¯·ç™»å½•å¾®ä¿¡å…¬ä¼—å·åå°æŸ¥çœ‹è‰ç¨¿ç®±');
                } else {
                    addLog('error', 'ä¸Šä¼ å¤±è´¥ï¼š' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                    alert('âŒ ä¸Šä¼ å¤±è´¥ï¼š' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                addLog('error', 'ä¸Šä¼ å¤±è´¥ï¼š' + error.message);
                alert('âŒ ä¸Šä¼ å¤±è´¥ï¼š' + error.message);
            }
        }

        // ç½‘é¡µç‰ˆå‘å¸ƒåˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆé€‚åˆä¸ªäººå…¬ä¼—å·ï¼‰
        async function uploadToWechatBrowser() {
            if (!window.currentResult) {
                alert('æ²¡æœ‰å¯å‘å¸ƒçš„æ–‡ç« ');
                return;
            }

            if (!confirm('ç¡®å®šè¦ä½¿ç”¨ç½‘é¡µç‰ˆå‘å¸ƒå—ï¼Ÿ\n\næ³¨æ„äº‹é¡¹ï¼š\n1. å°†è‡ªåŠ¨æ‰“å¼€ Chrome æµè§ˆå™¨\n2. é¦–æ¬¡ä½¿ç”¨éœ€è¦æ‰«ç ç™»å½•å¾®ä¿¡å…¬ä¼—å·\n3. ç™»å½•çŠ¶æ€ä¼šè¢«ä¿å­˜ï¼Œä¸‹æ¬¡æ— éœ€å†æ‰«\n4. éœ€è¦å®‰è£… Google Chrome æµè§ˆå™¨\n5. æ–‡ç« å°†ä¿å­˜ä¸ºè‰ç¨¿ï¼Œä¸ä¼šç›´æ¥å‘å¸ƒ')) {
                return;
            }

            const title = window.currentResult.title;
            const content = window.currentResult.content;

            try {
                addLog('info', 'æ­£åœ¨å¯åŠ¨ç½‘é¡µç‰ˆå¾®ä¿¡å‘å¸ƒ...');

                const response = await fetch('/api/upload-wechat-browser', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title: title,
                        content: content,
                        theme: 'default'
                    })
                });

                const data = await response.json();

                if (data.success) {
                    addLog('success', data.message);
                    alert('âœ… ' + data.message + '\n\nğŸ’¡ æç¤ºï¼šå¦‚æœæµè§ˆå™¨æ²¡æœ‰è‡ªåŠ¨æ‰“å¼€ï¼Œè¯·æ£€æŸ¥æ˜¯å¦æœ‰å¼¹çª—æ‹¦æˆª');
                } else {
                    addLog('error', 'å¯åŠ¨å¤±è´¥ï¼š' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                    alert('âŒ å¯åŠ¨å¤±è´¥ï¼š' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                addLog('error', 'å¯åŠ¨å¤±è´¥ï¼š' + error.message);
                alert('âŒ å¯åŠ¨å¤±è´¥ï¼š' + error.message);
            }
        }

        // é‡ç½® UI
        function resetUI() {
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            document.body.classList.remove('running');

            if (statusCheckInterval) {
                clearInterval(statusCheckInterval);
                statusCheckInterval = null;
            }
        }

        // åˆå§‹åŒ–
        window.onload = function() {
            addLog('info', 'ç³»ç»Ÿå·²å°±ç»ªï¼Œè¯·é€‰æ‹©æä¾›å•†å¹¶ç‚¹å‡»"å¼€å§‹ç”Ÿæˆ"');
            loadHistory(1);  // åŠ è½½å†å²æ–‡ä»¶ - ç¬¬ä¸€é¡µ
        };

        // åˆ†é¡µçŠ¶æ€å˜é‡
        let currentPageNum = 1;
        let totalPageCount = 1;
        let perPageCount = 10;

        // åŠ è½½å†å²æ–‡ä»¶åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µï¼‰
        async function loadHistory(page = 1) {
            currentPageNum = page;
            try {
                // æ·»åŠ æ—¶é—´æˆ³é˜²æ­¢ç¼“å­˜
                const cacheBuster = new Date().getTime();
                const response = await fetch(`/api/history?page=${page}&per_page=${perPageCount}&_=${cacheBuster}`);
                const data = await response.json();

                const container = document.getElementById('historyList');
                const paginationContainer = document.getElementById('paginationContainer');

                if (!data.success || data.history.length === 0) {
                    container.innerHTML = '<div class="empty-history">ğŸ“­ æš‚æ— å†å²æ–‡ç« </div>';
                    paginationContainer.style.display = 'none';
                    return;
                }

                // æ›´æ–°åˆ†é¡µä¿¡æ¯
                totalPageCount = data.pagination.total_pages;
                document.getElementById('currentPage').textContent = data.pagination.page;
                document.getElementById('totalPages').textContent = totalPageCount;
                document.getElementById('totalItems').textContent = data.pagination.total;

                // æ›´æ–°åˆ†é¡µæŒ‰é’®çŠ¶æ€
                document.getElementById('prevPageBtn').disabled = page <= 1;
                document.getElementById('nextPageBtn').disabled = page >= totalPageCount;

                // æ˜¾ç¤ºåˆ†é¡µæ§ä»¶
                paginationContainer.style.display = 'flex';

                container.innerHTML = '';
                data.history.forEach(item => {
                    const date = new Date(item.modified_time * 1000);
                    const dateStr = date.toLocaleString('zh-CN');
                    const sizeKB = (item.size / 1024).toFixed(1);

                    // æä¾›å•†æ ‡ç­¾æ ·å¼
                    let providerClass = '';
                    let providerLabel = item.provider || 'æœªçŸ¥';
                    if (providerLabel === 'Gemini API') {
                        providerClass = 'gemini-api';
                    } else if (providerLabel === 'Gemini Web') {
                        providerClass = 'gemini-web';
                    } else if (providerLabel === 'æ™ºè°± GLM') {
                        providerClass = 'zhipu';
                    } else if (providerLabel === 'Gemini Web + DeepSeek') {
                        providerClass = 'gemini-deepseek';
                    }

                    const div = document.createElement('div');
                    div.className = 'history-item';
                    div.innerHTML = `
                        <div class="history-info">
                            <div class="history-title">
                                ${escapeHtml(item.title)}
                                <span class="provider-badge ${providerClass}">${providerLabel}</span>
                            </div>
                            <div class="history-meta">${dateStr} Â· ${sizeKB} KB${item.ai_score ? ' Â· AIæ£€æµ‹: ' + item.ai_score : ''}</div>
                        </div>
                        <div class="history-actions">
                            <button class="history-btn" onclick="viewHistoryFile('${item.filename}')">ğŸ‘ï¸ æŸ¥çœ‹</button>
                            <button class="history-btn" onclick="uploadHistoryToWechat('${item.filename}', 'api')">ğŸ“¤ APIä¸Šä¼ </button>
                            <button class="history-btn" onclick="uploadHistoryToWechat('${item.filename}', 'browser')" style="background: linear-gradient(135deg, #1890ff 0%, #096dd9 100%); color: white; border: none;">ğŸŒ ç½‘é¡µå‘å¸ƒ</button>
                        </div>
                    `;
                    container.appendChild(div);
                });
            } catch (error) {
                console.error('åŠ è½½å†å²å¤±è´¥:', error);
                document.getElementById('historyList').innerHTML = '<div class="empty-history">âŒ åŠ è½½å¤±è´¥</div>';
                document.getElementById('paginationContainer').style.display = 'none';
            }
        }

        // åˆ‡æ¢é¡µé¢
        function changePage(delta) {
            const newPage = currentPageNum + delta;
            if (newPage >= 1 && newPage <= totalPageCount) {
                loadHistory(newPage);
            }
        }

        // æŸ¥çœ‹å†å²æ–‡ä»¶
        async function viewHistoryFile(filename) {
            try {
                const response = await fetch(`/api/history/${encodeURIComponent(filename)}`);
                const data = await response.json();

                if (!data.success) {
                    alert('åŠ è½½å¤±è´¥ï¼š' + data.error);
                    return;
                }

                // è§£ææ–‡ä»¶å†…å®¹ï¼Œæå–æ ‡é¢˜å’Œæ­£æ–‡
                let content = data.content;
                let title = filename;

                // é¦–å…ˆå°è¯•ä» HTML æ³¨é‡Šä¸­æå–æ ‡é¢˜
                const titleCommentMatch = content.match(/Title:\s*(.+?)\n/);
                if (titleCommentMatch) {
                    title = titleCommentMatch[1].trim();
                } else {
                    // å…¶æ¬¡å°è¯•æå– Markdown æ ‡é¢˜
                    const titleMatch = content.match(/^#\s+(.+)$/m);
                    if (titleMatch) {
                        title = titleMatch[1];
                        content = content.replace(/^#\s+.+$/m, '').trim();
                    }
                }

                // ç§»é™¤ HTML æ³¨é‡Šéƒ¨åˆ†ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                content = content.replace(/<!--[\s\S]*?-->/, '').trim();

                // å°† Markdown è½¬æ¢ä¸º HTML
                let html = content
                    .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                    .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                    .replace(/\*\*(.*?)\*\*/gim, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/gim, '<em>$1</em>')
                    .replace(/\n\n/gim, '</p><p>')
                    .replace(/\n/gim, '<br>');

                document.getElementById('previewContent').innerHTML = '<h1>' + escapeHtml(title) + '</h1><br>' + html;
                document.getElementById('previewModal').style.display = 'block';

            } catch (error) {
                alert('åŠ è½½å¤±è´¥ï¼š' + error.message);
            }
        }

        // ä¸Šä¼ å†å²æ–‡ä»¶åˆ°å¾®ä¿¡å…¬ä¼—å·
        async function uploadHistoryToWechat(filename, method = 'api') {
            if (method === 'api') {
                if (!confirm('ç¡®å®šè¦ä¸Šä¼ å†å²æ–‡ç« åˆ°å¾®ä¿¡å…¬ä¼—å·è‰ç¨¿ç®±å—ï¼Ÿ')) {
                    return;
                }
            } else {
                if (!confirm('ç¡®å®šè¦ä½¿ç”¨ç½‘é¡µç‰ˆå‘å¸ƒå—ï¼Ÿ\n\næ³¨æ„äº‹é¡¹ï¼š\n1. å°†è‡ªåŠ¨æ‰“å¼€ Chrome æµè§ˆå™¨\n2. é¦–æ¬¡ä½¿ç”¨éœ€è¦æ‰«ç ç™»å½•å¾®ä¿¡å…¬ä¼—å·\n3. ç™»å½•çŠ¶æ€ä¼šè¢«ä¿å­˜ï¼Œä¸‹æ¬¡æ— éœ€å†æ‰«\n4. éœ€è¦å®‰è£… Google Chrome æµè§ˆå™¨\n5. æ–‡ç« å°†ä¿å­˜ä¸ºè‰ç¨¿ï¼Œä¸ä¼šç›´æ¥å‘å¸ƒ')) {
                    return;
                }
            }

            try {
                // å…ˆè·å–æ–‡ä»¶å†…å®¹
                const response = await fetch(`/api/history/${encodeURIComponent(filename)}`);
                const data = await response.json();

                if (!data.success) {
                    alert('åŠ è½½å¤±è´¥ï¼š' + data.error);
                    return;
                }

                // è§£ææ ‡é¢˜å’Œå†…å®¹
                let content = data.content;
                let title = filename;

                // é¦–å…ˆå°è¯•ä» HTML æ³¨é‡Šä¸­æå–æ ‡é¢˜
                const titleCommentMatch = content.match(/Title:\s*(.+?)\n/);
                if (titleCommentMatch) {
                    title = titleCommentMatch[1].trim();
                } else {
                    // å…¶æ¬¡å°è¯•æå– Markdown æ ‡é¢˜
                    const titleMatch = content.match(/^#\s+(.+)$/m);
                    if (titleMatch) {
                        title = titleMatch[1];
                    }
                }

                // ç§»é™¤ HTML æ³¨é‡Šéƒ¨åˆ†ï¼ˆé¿å…å‘é€åˆ°å¾®ä¿¡ï¼‰
                content = content.replace(/<!--[\s\S]*?-->/, '').trim();

                // å¦‚æœæœ‰ Markdown æ ‡é¢˜ä¸”ä¸åœ¨æ³¨é‡Šä¸­ï¼Œä¹Ÿç§»é™¤å®ƒï¼ˆå› ä¸ºæ ‡é¢˜å•ç‹¬å‘é€ï¼‰
                const titleMatch = content.match(/^#\s+.+$/m);
                if (titleMatch) {
                    content = content.replace(/^#\s+.+$/m, '').trim();
                }

                // æ ¹æ®æ–¹æ³•é€‰æ‹©ä¸Šä¼ æ–¹å¼
                if (method === 'browser') {
                    // ç½‘é¡µç‰ˆå‘å¸ƒ
                    const uploadResponse = await fetch('/api/upload-wechat-browser', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            title: title,
                            content: content,
                            theme: 'default'
                        })
                    });

                    const uploadData = await uploadResponse.json();

                    if (uploadData.success) {
                        alert('âœ… ' + uploadData.message + '\n\nğŸ’¡ æç¤ºï¼šå¦‚æœæµè§ˆå™¨æ²¡æœ‰è‡ªåŠ¨æ‰“å¼€ï¼Œè¯·æ£€æŸ¥æ˜¯å¦æœ‰å¼¹çª—æ‹¦æˆª');
                    } else {
                        alert('âŒ å¯åŠ¨å¤±è´¥ï¼š' + (uploadData.error || 'æœªçŸ¥é”™è¯¯'));
                    }
                } else {
                    // API ä¸Šä¼ 
                    const uploadResponse = await fetch('/api/upload-wechat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            title: title,
                            content: content
                        })
                    });

                    const uploadData = await uploadResponse.json();

                    if (uploadData.success) {
                        alert('âœ… ä¸Šä¼ æˆåŠŸï¼\n\nè¯·ç™»å½•å¾®ä¿¡å…¬ä¼—å·åå°æŸ¥çœ‹è‰ç¨¿ç®±');
                    } else {
                        alert('âŒ ä¸Šä¼ å¤±è´¥ï¼š' + (uploadData.error || 'æœªçŸ¥é”™è¯¯'));
                    }
                }
            } catch (error) {
                alert('âŒ ä¸Šä¼ å¤±è´¥ï¼š' + error.message);
            }
        }

        // HTML è½¬ä¹‰å‡½æ•°
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ========== æµç¨‹é…ç½®ç›¸å…³ ==========
        let promptsConfig = {};
        let currentEditingProvider = 'gemini-web';

        // æ‰“å¼€é…ç½®ç•Œé¢
        async function openPromptConfig() {
            const modal = document.getElementById('promptConfigModal');
            modal.style.display = 'flex';

            // åŠ è½½é…ç½®
            await loadPromptsConfig();

            // è·å–å½“å‰é€‰ä¸­çš„ provider
            const activeProvider = document.querySelector('.provider-option.active');
            if (activeProvider) {
                currentEditingProvider = activeProvider.getAttribute('data-provider');
            }

            // æ˜¾ç¤ºå½“å‰é€‰ä¸­çš„ provider é…ç½®
            showProviderConfig(currentEditingProvider);
        }

        // å…³é—­é…ç½®ç•Œé¢
        function closePromptConfig() {
            document.getElementById('promptConfigModal').style.display = 'none';
        }

        // åŠ è½½é…ç½®
        async function loadPromptsConfig() {
            try {
                const response = await fetch('/api/prompts-config');
                const data = await response.json();

                if (data.success) {
                    promptsConfig = data.config;
                    populateProviderSelect();
                } else {
                    alert('åŠ è½½é…ç½®å¤±è´¥ï¼š' + data.error);
                }
            } catch (error) {
                alert('åŠ è½½é…ç½®å¤±è´¥ï¼š' + error.message);
            }
        }

        // å¡«å…… provider é€‰æ‹©å™¨
        function populateProviderSelect() {
            const select = document.getElementById('configProviderSelect');
            select.innerHTML = '';

            for (const [key, value] of Object.entries(promptsConfig)) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = value.name || key;
                select.appendChild(option);
            }

            select.value = currentEditingProvider;
        }

        // æ˜¾ç¤ºæŒ‡å®š provider çš„é…ç½®
        function showProviderConfig(provider) {
            currentEditingProvider = provider;
            const config = promptsConfig[provider];

            // æ˜¾ç¤ºé…ç½®åç§°å’Œæè¿°
            document.getElementById('configProviderName').textContent = config.name || provider;

            // å¡«å……åŸºæœ¬è®¾ç½®
            document.getElementById('configIterations').value = config.ai_iterations || 2;
            document.getElementById('configTargetScore').value = config.target_ai_score || 30;
            document.getElementById('configArticleLength').value = config.article_length || 2000;

            // å¡«å……æ­¥éª¤é…ç½®
            const stepsContainer = document.getElementById('configStepsContainer');
            stepsContainer.innerHTML = '';

            if (config.steps && config.steps.length > 0) {
                config.steps.forEach((step, index) => {
                    const stepHtml = createStepEditor(index, step);
                    stepsContainer.insertAdjacentHTML('beforeend', stepHtml);
                });
            }
        }

        // åˆ›å»ºæ­¥éª¤ç¼–è¾‘å™¨
        function createStepEditor(index, step) {
            return `
                <div class="config-step-item" data-step-index="${index}">
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <input type="text" class="step-name-input" value="${step.name || ''}" placeholder="æ­¥éª¤åç§°" style="flex: 1;">
                        ${step.model ? `<input type="text" class="step-model-input" value="${step.model || ''}" placeholder="æ¨¡å‹ (å¯é€‰)" style="flex: 1;">` : ''}
                    </div>
                    <textarea class="step-prompt-input" rows="6" placeholder="æç¤ºè¯ï¼ˆå¯ä½¿ç”¨å˜é‡ï¼š{domain}, {title}, {outline}, {article}, {length}ï¼‰">${step.prompt || ''}</textarea>
                    <button class="btn btn-secondary" onclick="removeStep(${index})" style="margin-top: 5px; padding: 5px 10px; font-size: 12px;">ğŸ—‘ï¸ åˆ é™¤æ­¥éª¤</button>
                </div>
            `;
        }

        // æ·»åŠ æ­¥éª¤
        function addStep() {
            const stepsContainer = document.getElementById('configStepsContainer');
            const index = stepsContainer.children.length;
            const stepHtml = createStepEditor(index, { name: 'æ–°æ­¥éª¤', prompt: '' });
            stepsContainer.insertAdjacentHTML('beforeend', stepHtml);
        }

        // åˆ é™¤æ­¥éª¤
        function removeStep(index) {
            const stepItem = document.querySelector(`.config-step-item[data-step-index="${index}"]`);
            if (stepItem) {
                stepItem.remove();
            }
        }

        // ä¿å­˜é…ç½®
        async function savePromptsConfig() {
            try {
                // æ”¶é›†é…ç½®æ•°æ®
                const config = promptsConfig[currentEditingProvider];

                // åŸºæœ¬è®¾ç½®
                config.ai_iterations = parseInt(document.getElementById('configIterations').value) || 2;
                config.target_ai_score = parseInt(document.getElementById('configTargetScore').value) || 30;
                config.article_length = parseInt(document.getElementById('configArticleLength').value) || 2000;

                // æ”¶é›†æ­¥éª¤
                const steps = [];
                const stepItems = document.querySelectorAll('.config-step-item');

                stepItems.forEach(item => {
                    const name = item.querySelector('.step-name-input').value;
                    const modelInput = item.querySelector('.step-model-input');
                    const prompt = item.querySelector('.step-prompt-input').value;

                    const step = { name, prompt };
                    if (modelInput) {
                        step.model = modelInput.value;
                    }

                    steps.push(step);
                });

                config.steps = steps;

                // ä¿å­˜åˆ°æœåŠ¡å™¨
                const response = await fetch('/api/prompts-config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ config: promptsConfig })
                });

                const data = await response.json();

                if (data.success) {
                    alert('âœ… é…ç½®å·²ä¿å­˜ï¼');
                    closePromptConfig();
                } else {
                    alert('âŒ ä¿å­˜å¤±è´¥ï¼š' + data.error);
                }
            } catch (error) {
                alert('âŒ ä¿å­˜å¤±è´¥ï¼š' + error.message);
            }
        }

        // åˆ‡æ¢ provider æ—¶æ˜¾ç¤ºå¯¹åº”é…ç½®
        function onProviderChange() {
            const select = document.getElementById('configProviderSelect');
            showProviderConfig(select.value);
        }
    </script>

    <!-- æµç¨‹é…ç½®æ¨¡æ€æ¡† -->
    <div id="promptConfigModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0;">âš™ï¸ æµç¨‹é…ç½®</h2>
                <button onclick="closePromptConfig()" style="background: none; border: none; font-size: 24px; cursor: pointer;">âœ•</button>
            </div>

            <!-- Provider é€‰æ‹© -->
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">é€‰æ‹©æ¨¡å‹ï¼š</label>
                <select id="configProviderSelect" onchange="onProviderChange()" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 15px;">
                </select>
            </div>

            <!-- åŸºæœ¬è®¾ç½® -->
            <div style="margin-bottom: 20px;">
                <h3 id="configProviderName" style="margin-bottom: 15px; color: #667eea;">é…ç½®</h3>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 14px; color: #666;">AI è¿­ä»£æ¬¡æ•°ï¼š</label>
                        <input type="number" id="configIterations" min="1" max="10" value="2" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 14px; color: #666;">ç›®æ ‡ AI è¯„åˆ†ï¼š</label>
                        <input type="number" id="configTargetScore" min="0" max="100" value="30" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 14px; color: #666;">æ–‡ç« å­—æ•°ï¼š</label>
                        <input type="number" id="configArticleLength" min="500" max="10000" value="2000" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px;">
                    </div>
                </div>
            </div>

            <!-- æ­¥éª¤é…ç½® -->
            <div style="margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0;">ç”Ÿæˆæ­¥éª¤</h3>
                    <button class="btn btn-secondary" onclick="addStep()" style="padding: 8px 16px; font-size: 14px;">â• æ·»åŠ æ­¥éª¤</button>
                </div>
                <div id="configStepsContainer" style="max-height: 400px; overflow-y: auto;">
                </div>
            </div>

            <!-- å˜é‡è¯´æ˜ -->
            <div style="background: #f0f4ff; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <p style="margin: 0; font-size: 14px; color: #666;">
                    <strong>å¯ç”¨å˜é‡ï¼š</strong> {domain} - é¢†åŸŸ | {title} - æ ‡é¢˜ | {outline} - å¤§çº² | {article} - æ–‡ç« å†…å®¹ | {length} - å­—æ•°
                </p>
            </div>

            <!-- æ“ä½œæŒ‰é’® -->
            <div style="display: flex; justify-content: flex-end; gap: 10px;">
                <button class="btn btn-secondary" onclick="closePromptConfig()" style="padding: 12px 24px;">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="savePromptsConfig()" style="padding: 12px 24px;">ğŸ’¾ ä¿å­˜é…ç½®</button>
            </div>
        </div>
    </div>

    <style>
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 800px;
        }

        .config-step-item {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 2px solid #e0e0e0;
        }

        .step-name-input, .step-model-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
        }

        .step-prompt-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            font-family: 'Consolas', 'Monaco', monospace;
            resize: vertical;
        }
    </style>
</body>
</html>
